"""
net_oddball_sequence.py

Implements the auditory cortex network model from Beeman et al., BMC Neuroscience, 2017 and Kudela et al.,
Frontiers in Neural Circuits, 2018.

An oddball sequence of 10 stimuli is implemented

Contributor: Christoph Metzner, christoph.metzner@gmail.com, 17/09/2018
"""

from net_params_oddball_sequence import set_params
from netpyne import sim
import numpy as np
from MP_class import PoolManager

from config import D1, D2, LOW_GABA, HIGH_GABA

from variation_utils import set_var
from config import N_PEAKS, N_MSRMNT, JSONS_DIR
from variations import SAMPLE_VAR, MULTI_GENE_VAR, SINGLE_VAR

def run_sim (params):
    # get params
    d1, d2, gaba, name = params
    NP, SC = set_params(d1_param=d1, d2_param=d2, gaba_w = gaba, fig_name=name)

    sim.createSimulateAnalyze(netParams=NP, simConfig=SC)

    #import pylab; pylab.show()  # this line is only necessary in certain systems where figures appear empty

    exit()

if __name__ == '__main__':
    ## basic param modification

    timeout_hrs = 600000000


    #set_var(SAMPLE_VAR)

    #grid_search_full = [[0.45, 0.65, 0.002, '0.45_0.65_0.002'], [0.45, 0.7, 0.002, '0.45_0.7_0.002'], [0.45, 0.75, 0.002, '0.45_0.75_0.002'], [0.45, 0.8, 0.002, '0.45_0.8_0.002'], [0.45, 0.85, 0.002, '0.45_0.85_0.002'], [0.45, 0.9, 0.002, '0.45_0.9_0.002'], [0.45, 0.95, 0.002, '0.45_0.95_0.002'], [0.45, 0.99, 0.002, '0.45_0.99_0.002'], [0.5, 0.65, 0.002, '0.5_0.65_0.002'], [0.5, 0.7, 0.002, '0.5_0.7_0.002'], [0.5, 0.75, 0.002, '0.5_0.75_0.002'], [0.5, 0.8, 0.002, '0.5_0.8_0.002'], [0.5, 0.85, 0.002, '0.5_0.85_0.002'], [0.5, 0.9, 0.002, '0.5_0.9_0.002'], [0.5, 0.95, 0.002, '0.5_0.95_0.002'], [0.5, 0.99, 0.002, '0.5_0.99_0.002'], [0.55, 0.65, 0.002, '0.55_0.65_0.002'], [0.55, 0.7, 0.002, '0.55_0.7_0.002'], [0.55, 0.75, 0.002, '0.55_0.75_0.002'], [0.55, 0.8, 0.002, '0.55_0.8_0.002'], [0.55, 0.85, 0.002, '0.55_0.85_0.002'], [0.55, 0.9, 0.002, '0.55_0.9_0.002'], [0.55, 0.95, 0.002, '0.55_0.95_0.002'], [0.55, 0.99, 0.002, '0.55_0.99_0.002'], [0.6, 0.65, 0.002, '0.6_0.65_0.002'], [0.6, 0.7, 0.002, '0.6_0.7_0.002'], [0.6, 0.75, 0.002, '0.6_0.75_0.002'], [0.6, 0.8, 0.002, '0.6_0.8_0.002'], [0.6, 0.85, 0.002, '0.6_0.85_0.002'], [0.6, 0.9, 0.002, '0.6_0.9_0.002'], [0.6, 0.95, 0.002, '0.6_0.95_0.002'], [0.6, 0.99, 0.002, '0.6_0.99_0.002'], [0.65, 0.65, 0.002, '0.65_0.65_0.002'], [0.65, 0.7, 0.002, '0.65_0.7_0.002'], [0.65, 0.75, 0.002, '0.65_0.75_0.002'], [0.65, 0.8, 0.002, '0.65_0.8_0.002'], [0.65, 0.85, 0.002, '0.65_0.85_0.002'], [0.65, 0.9, 0.002, '0.65_0.9_0.002'], [0.65, 0.95, 0.002, '0.65_0.95_0.002'], [0.65, 0.99, 0.002, '0.65_0.99_0.002'], [0.7, 0.65, 0.002, '0.7_0.65_0.002'], [0.7, 0.7, 0.002, '0.7_0.7_0.002'], [0.7, 0.75, 0.002, '0.7_0.75_0.002'], [0.7, 0.8, 0.002, '0.7_0.8_0.002'], [0.7, 0.85, 0.002, '0.7_0.85_0.002'], [0.7, 0.9, 0.002, '0.7_0.9_0.002'], [0.7, 0.95, 0.002, '0.7_0.95_0.002'], [0.7, 0.99, 0.002, '0.7_0.99_0.002'], [0.75, 0.65, 0.002, '0.75_0.65_0.002'], [0.75, 0.7, 0.002, '0.75_0.7_0.002'], [0.75, 0.75, 0.002, '0.75_0.75_0.002'], [0.75, 0.8, 0.002, '0.75_0.8_0.002'], [0.75, 0.85, 0.002, '0.75_0.85_0.002'], [0.75, 0.9, 0.002, '0.75_0.9_0.002'], [0.75, 0.95, 0.002, '0.75_0.95_0.002'], [0.75, 0.99, 0.002, '0.75_0.99_0.002'], [0.8, 0.65, 0.002, '0.8_0.65_0.002'], [0.8, 0.7, 0.002, '0.8_0.7_0.002'], [0.8, 0.75, 0.002, '0.8_0.75_0.002'], [0.8, 0.8, 0.002, '0.8_0.8_0.002'], [0.8, 0.85, 0.002, '0.8_0.85_0.002'], [0.8, 0.9, 0.002, '0.8_0.9_0.002'], [0.8, 0.95, 0.002, '0.8_0.95_0.002'], [0.8, 0.99, 0.002, '0.8_0.99_0.002'], [0.85, 0.65, 0.002, '0.85_0.65_0.002'], [0.85, 0.7, 0.002, '0.85_0.7_0.002'], [0.85, 0.75, 0.002, '0.85_0.75_0.002'], [0.85, 0.8, 0.002, '0.85_0.8_0.002'], [0.85, 0.85, 0.002, '0.85_0.85_0.002'], [0.85, 0.9, 0.002, '0.85_0.9_0.002'], [0.85, 0.95, 0.002, '0.85_0.95_0.002'], [0.85, 0.99, 0.002, '0.85_0.99_0.002'], [0.9, 0.65, 0.002, '0.9_0.65_0.002'], [0.9, 0.7, 0.002, '0.9_0.7_0.002'], [0.9, 0.75, 0.002, '0.9_0.75_0.002'], [0.9, 0.8, 0.002, '0.9_0.8_0.002'], [0.9, 0.85, 0.002, '0.9_0.85_0.002'], [0.9, 0.9, 0.002, '0.9_0.9_0.002'], [0.9, 0.95, 0.002, '0.9_0.95_0.002'], [0.9, 0.99, 0.002, '0.9_0.99_0.002'], [0.95, 0.65, 0.002, '0.95_0.65_0.002'], [0.95, 0.7, 0.002, '0.95_0.7_0.002'], [0.95, 0.75, 0.002, '0.95_0.75_0.002'], [0.95, 0.8, 0.002, '0.95_0.8_0.002'], [0.95, 0.85, 0.002, '0.95_0.85_0.002'], [0.95, 0.9, 0.002, '0.95_0.9_0.002'], [0.95, 0.95, 0.002, '0.95_0.95_0.002'], [0.95, 0.99, 0.002, '0.95_0.99_0.002']]

    
    #beg,fin = 40, 88

    grid_search_array = [[0.6, 0.91, 0.001, 'Test_D1_06_D2_081_long']]  # grid_search_full[beg:fin]



    sim_pool_manager = PoolManager(num_workers=4)
    sim_pool_manager.worker(run_sim, grid_search_array, timeout= 60*60*timeout_hrs)
